<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C√°i ti·ªám b√°n t√°o ‚Äì by Tina House</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;700&display=swap" rel="stylesheet">

<link rel="icon" type="image/jpeg" href="Logo.jpeg" style="border-radius: 50%;" />

<style>
  :root{
    --brand: #12B7FF;
    --brand-dark: #0B8ED1;
    --border: #d6e6f2;
    --muted: #54647a;
    --text: #0b1220;
    --bg: #FFFFFF;
    --header-bg: #DAF0F7;
    --header-text: #38B6FF;
    --card-titlebar: #E6F7FF;
    --hover: #f6fbff;
    --shadow-card: 0 6px 18px rgba(18, 183, 255, 0.08);
    --ok-bg: #e6ffef;  --ok-text:#007a33;  --ok-border:#b8f5cf;
    --bad-bg:#ffeff0;  --bad-text:#b00020; --bad-border:#ffd0d3;
    --blue-bg:#e6f7ff; --blue-text:#055b8a; --blue-border:#c9eaff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:var(--bg); overflow-x:hidden;
  }
  .wrap{max-width:1200px; margin:0 auto; padding:14px 16px}

  /* HEADER */
  header{
    position:sticky; top:0; z-index:10;
    background:var(--header-bg); color:var(--header-text);
    border-bottom:1px solid var(--border);
    box-shadow:0 2px 6px rgba(0,0,0,0.04);
  }
  .title-area { display: flex; align-items: center; gap: 12px; }
  
  /* ‚≠ê LOGO STYLE */
  .logo-img {
    height: 55px; /* Chi·ªÅu cao tr√™n m√°y t√≠nh */
    width: auto;
    border-radius: 8px; 
    box-shadow: 0 2px 5px rgba(18, 183, 255, 0.2); 
    object-fit: contain;
  }

  .title{
    font-family: 'Comfortaa', system-ui, sans-serif;
    font-weight:700; font-size:24px; color:#8dc4ef;
    line-height: 1.2;
  }
  .subtitle-small{
    font-size:65%; font-weight:600; opacity:.9;
    margin-left:2px; letter-spacing:-.2px; display:inline-block;
  }

  /* TABS */
  .tabs{ margin-top:14px; margin-bottom:14px; display:flex; flex-wrap:wrap; gap:8px; }
  .tab-btn{
    border:none; outline:none; cursor:pointer;
    padding:8px 18px; border-radius:999px;
    background:#ffffff; color:#082947;
    font-weight:700; font-size:14px;
    box-shadow:0 0 0 1px var(--border); transition:all .15s ease;
  }
  .tab-btn:hover{ box-shadow:0 0 0 1px var(--brand-dark); }
  .tab-btn.active{ background:#123f9d; color:#ffffff; box-shadow:none; }

  /* B·∫¢NG GI√Å */
  .card{
    background:#fff; border:1.5px solid var(--border);
    border-radius:14px; overflow:hidden; box-shadow:var(--shadow-card);
  }
  .card .titlebar{
    background:var(--card-titlebar); padding:10px 16px; font-weight:800;
    border-bottom:1px solid var(--border); color:var(--brand-dark);
    display:flex; justify-content:space-between; align-items:center;
  }
  @keyframes flash { 0%{opacity:1} 50%{opacity:0.5} 100%{opacity:1} }
  .updating .table-wrap { animation: flash 0.5s ease; }

  .table-wrap{ overflow-x:hidden; overflow-y:auto; transition: opacity 0.3s; }
  table{ width:100%; border-collapse:collapse; font-size:14px; table-layout:fixed; }
  th,td{
    padding:10px 8px; border-bottom:1px solid var(--border);
    text-align:left; white-space:nowrap;
  }
  th{font-weight:800}
  td.price{ text-align:center; font-variant-numeric:tabular-nums; white-space:nowrap; }
  tbody tr:hover{background:var(--hover)}
  
  /* Nh√≥m s·∫£n ph·∫©m */
  tbody tr.groupname td{ background:#f9fcff; font-weight:900; font-size:15px; color:#082947; }

  /* Nh√£n (M·ªõi, C√≤n h√†ng...) */
  .pill{
    display:inline-block; padding:2px 8px;
    border-radius:999px; font-size:12px; font-weight:800; white-space:nowrap;
  }
  .pill.ok{background:var(--ok-bg); color:var(--ok-text); border:1px solid var(--ok-border)}
  .pill.bad{background:var(--bad-bg); color:var(--bad-text); border:1px solid var(--bad-border)}
  .pill.blue{background:var(--blue-bg); color:var(--blue-text); border:1px solid var(--blue-border)}

  /* CƒÉn ch·ªânh c·ªôt */
  th:nth-child(1){ width:55%; }
  th:nth-child(2){ width:26%; text-align:center; }
  th:nth-child(3){ width:19%; text-align:center; }
  td:nth-child(3){ text-align:center; padding-right:10px; }
  td:nth-child(3) .pill{
    display:inline-flex; align-items:center; justify-content:center;
    min-width:55px; text-align:center;
  }

  /* ‚≠ê MOBILE RESPONSIVE */
  @media (max-width:640px){
    .wrap{padding:12px 10px;}
    .logo-img { height: 45px; } 
    .title { font-size: 22px; }
    .title-area { gap: 10px; }
    table{font-size:13px;}
    th,td{ padding:8px 4px; white-space:nowrap; }
    td:first-child{ white-space:normal; word-break:break-word; }
  }

  /* FORM LI√äN H·ªÜ G·ªåN */
  .contact-box{
    margin-top:12px; padding:12px 16px;
    background:#e8f6ff; border:1.5px solid var(--border);
    border-radius:14px; box-shadow:0 4px 10px rgba(18,183,255,0.08);
    color:#082947;
  }
  .contact-title{ font-weight:800; font-size:15px; color:#0B8ED1; margin-bottom:6px; }
  .contact-info{ font-size:14px; line-height:1.55; }
  .contact-info a{ color:#0B8ED1; font-weight:700; text-decoration:none; }
  .contact-info a:hover{ text-decoration:underline; }
  
  .status-text { font-size: 11px; font-weight: normal; opacity: 0.7; color: #54647a; }
</style>

<script>
// LINK GOOGLE SHEET (CSV)
const URL_ALL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vScB3O9RHORztA1jt0R9IU74vKx19WcpMgh_N6eOU2uKcmczj44re7jb7KqF4Acz-gwCIgPNK3THJlF/pub?output=csv";

// DANH S√ÅCH DANH M·ª§C
const CATS = ["AirPods", "iPad", "iPhone", "MacBook", "Pencil", "Apple Watch", "Loa", "Ph·ª• ki·ªán"];

let ALL_ROWS = [];
let CURRENT_CAT = "AirPods";
let TIMER = null; 

function parseCSV(text){
  const rows=[]; let i=0, field='', row=[], inQuotes=false;
  while(i<text.length){
    const c=text[i];
    if(inQuotes){
      if(c==='"'){ if(text[i+1]==='"'){ field+='"'; i++; } else inQuotes=false; }
      else field+=c;
    } else {
      if(c===','){ row.push(field); field=''; }
      else if(c==='\n'){ row.push(field); rows.push(row); row=[]; field=''; }
      else if(c==='"'){ inQuotes=true; }
      else field+=c;
    }
    i++;
  }
  if(field.length||row.length){ row.push(field); rows.push(row); }
  return rows;
}

function mapHeaderVN(h){
  const key=(h||'').toLowerCase().normalize('NFD').replace(/[ÃÄ-ÕØ]/g,'').replace(/[^a-z0-9]+/g,'_').replace(/^_|_$/g,'');
  const map={'danh_muc':'danh_muc','dong_san_pham':'dong_san_pham','ten_san_pham':'ten_san_pham','don_gia_vnd':'don_gia_vnd','ghi_chu':'ghi_chu'};
  return map[key]||key;
}

async function fetchAll(url){
  const noCacheUrl = url + "&t=" + Date.now();
  const res=await fetch(noCacheUrl,{cache:'no-store'});
  if(!res.ok) throw new Error('HTTP '+res.status);
  const text=await res.text();
  const rows=parseCSV(text);
  const headers=rows[0].map(mapHeaderVN);
  return rows.slice(1).filter(r=>r.some(x=>(x||'').trim().length)).map(r=>{
    const o={}; headers.forEach((h,i)=>o[h]=(r[i]||'').trim()); return o;
  });
}

function fmtPrice(v){
  const cleaned=(v||'').toString().replace(/[.,]/g,'');
  const n=parseFloat(cleaned);
  return (!isNaN(n)&&n>0)? n.toLocaleString('vi-VN'):'‚Äî';
}

function badge(text){
  if(!text) return '';
  const t=text.toLowerCase();
  if(t.includes('h·∫øt')) return `<span class='pill bad'>${text}</span>`;
  if(t.includes('c√≤n')) return `<span class='pill ok'>${text}</span>`;
  return `<span class='pill blue'>${text}</span>`;
}

function renderBoardFor(cat){
  const tbody = document.querySelector('#board-main tbody');
  const titlebarText = document.querySelector('#board-main .titlebar .cat-name');
  titlebarText.textContent = cat;
  const key = cat.toLowerCase().trim();

  const rows = ALL_ROWS.filter(x => (x.danh_muc || '').toLowerCase().trim() === key);

  if(!rows.length){
    tbody.innerHTML = `<tr><td colspan="3">Ch∆∞a c√≥ d·ªØ li·ªáu cho danh m·ª•c n√†y.</td></tr>`;
    return;
  }

  const groups = {};
  const groupOrder = [];

  rows.forEach(r=>{
    const g = (r.dong_san_pham || 'Kh√°c').trim();
    if(!groups[g]) {
        groups[g]=[];
        groupOrder.push(g);
    }
    groups[g].push(r);
  });

  let html = '';
  groupOrder.forEach(g=>{
    html += `<tr class='groupname'><td colspan='3'>${g}</td></tr>`;
    groups[g].forEach(r=>{
      html += `<tr>
        <td>${r.ten_san_pham || ''}</td>
        <td class='price'>${fmtPrice(r.don_gia_vnd)}</td>
        <td>${badge(r.ghi_chu)}</td>
      </tr>`;
    });
  });
  tbody.innerHTML = html;
}

function setupTabs(){
  const container = document.querySelector('.tabs');
  container.innerHTML = CATS.map((cat,idx)=>`
    <button class="tab-btn ${idx===0?'active':''}" data-cat="${cat}">${cat}</button>
  `).join('');

  container.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const cat = btn.dataset.cat;
      CURRENT_CAT = cat;
      container.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active', b === btn));
      renderBoardFor(cat);
    });
  });
}

async function autoUpdateSilent(){
  const statusEl = document.querySelector('.status-text');
  try {
    const newRows = await fetchAll(URL_ALL);
    ALL_ROWS = newRows;
    renderBoardFor(CURRENT_CAT);
    if(statusEl) statusEl.textContent = "C·∫≠p nh·∫≠t: " + new Date().toLocaleTimeString('vi-VN');
  } catch(e) {
    console.log("L·ªói c·∫≠p nh·∫≠t ng·∫ßm: " + e);
  }
}

async function boot(){
  document.querySelector('#board-main tbody').innerHTML = `<tr><td colspan="3">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</td></tr>`;
  try{
    ALL_ROWS = await fetchAll(URL_ALL);
    setupTabs();
    renderBoardFor(CURRENT_CAT);
    TIMER = setInterval(autoUpdateSilent, 60000);
  }catch(e){
    console.error(e);
    document.querySelector('#board-main tbody').innerHTML = `<tr><td colspan="3">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu, b·∫°n F5 l·∫°i gi√∫p m√¨nh nha.</td></tr>`;
  }
}

window.addEventListener('DOMContentLoaded',boot);
</script>
</head>

<body>
  <header class="wrap">
    <div class="title-area">
       <img 
         src="Logo.jpeg" 
         alt="Logo C√°i Ti·ªám B√°n T√°o" 
         class="logo-img" 
       />
       
       <div class="title">C√°i ti·ªám b√°n t√°o <span class="subtitle-small">by Tina House</span></div>
    </div>

    <div class="contact-box">
      <div class="contact-title">üìû Th√¥ng tin li√™n h·ªá</div>
      <div class="contact-info">
        <div><strong>ƒêT:</strong> <a href="tel:0923453003">0923453003</a></div>
        <div><strong>Zalo:</strong> <a href="https://zalo.me/0923453003" target="_blank">0923453003</a></div>
        <div><strong>Telegram:</strong> <a href="https://t.me/caitiembantao" target="_blank">@caitiembantao</a></div>
        <div><strong>Facebook:</strong> <a href="https://www.facebook.com/people/C√°i-Ti·ªám-B√°n-T√°o/61550756556069/" target="_blank">fb.com/caitiembantao</a></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="tabs"></div>
    <div class="card" id="board-main">
      <div class="titlebar">
        <span class="cat-name">AirPods</span>
        <span class="status-text"></span>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>S·∫£n ph·∫©m</th>
              <th>ƒê∆°n gi√° (VND)</th>
              <th>Ghi ch√∫</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>
</body>
</html>
